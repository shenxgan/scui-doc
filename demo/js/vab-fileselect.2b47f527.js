"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[5901],{6006:function(e,l,t){t.r(l),t.d(l,{default:function(){return A}});var i=t(641);function s(e,l,t,s,a,o){const r=(0,i.g2)("el-alert"),u=(0,i.g2)("el-button"),n=(0,i.g2)("sc-file-select"),c=(0,i.g2)("el-card"),d=(0,i.g2)("el-col"),p=(0,i.g2)("el-row"),f=(0,i.g2)("el-main");return(0,i.uX)(),(0,i.Wv)(f,null,{default:(0,i.k6)((()=>[(0,i.bF)(p,{gutter:15},{default:(0,i.k6)((()=>[(0,i.bF)(d,{lg:18},{default:(0,i.k6)((()=>[(0,i.bF)(c,{shadow:"never"},{default:(0,i.k6)((()=>[(0,i.bF)(r,{title:"资源库选择器即将弃用,将不会维护更新,与1.7版本之后将移除此组件",type:"error",style:{"margin-bottom":"20px"}}),(0,i.bF)(n,{modelValue:a.file,"onUpdate:modelValue":l[0]||(l[0]=e=>a.file=e),multiple:a.multiple,hideUpload:a.hideUpload,max:99,onSubmit:o.submit},{do:(0,i.k6)((()=>[(0,i.bF)(u,null,{default:(0,i.k6)((()=>l[3]||(l[3]=[(0,i.eW)("自定义插槽")]))),_:1})])),_:1},8,["modelValue","multiple","hideUpload","onSubmit"])])),_:1})])),_:1}),(0,i.bF)(d,{lg:6},{default:(0,i.k6)((()=>[(0,i.bF)(c,{shadow:"never",header:"参数和方法"},{default:(0,i.k6)((()=>[(0,i.bF)(u,{type:"primary",onClick:l[1]||(l[1]=e=>a.multiple=!a.multiple)},{default:(0,i.k6)((()=>l[4]||(l[4]=[(0,i.eW)("切换multiple")]))),_:1}),(0,i.bF)(u,{type:"primary",onClick:l[2]||(l[2]=e=>a.hideUpload=!a.hideUpload)},{default:(0,i.k6)((()=>l[5]||(l[5]=[(0,i.eW)("切换hideUpload")]))),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}var a=t(33),o=t(3751);const r={class:"sc-file-select"},u={class:"sc-file-select__side"},n={class:"sc-file-select__side-menu"},c={class:"el-tree-node__label"},d={key:0,class:"sc-file-select__side-msg"},p={class:"sc-file-select__files"},f={class:"sc-file-select__top"},m={key:0,class:"upload"},g={class:"tips"},h={class:"keyword"},k={class:"sc-file-select__list"},_={class:"sc-file-select__item__file"},b={class:"sc-file-select__item__upload"},y=["onClick"],v={class:"sc-file-select__item__file"},C={key:0,class:"sc-file-select__item__checkbox"},P={key:1,class:"sc-file-select__item__select"},F={key:3,class:"item-file item-file-doc"},x={key:1,class:"sc-icon-file-list-fill",style:{color:"#999"}},L=["title"],w={class:"sc-file-select__pagination"},S={class:"sc-file-select__do"};function E(e,l,t,s,E,I){const N=(0,i.g2)("el-icon-folder"),z=(0,i.g2)("el-icon"),X=(0,i.g2)("el-tree"),U=(0,i.g2)("el-button"),O=(0,i.g2)("el-upload"),W=(0,i.g2)("el-icon-warning"),j=(0,i.g2)("el-input"),A=(0,i.g2)("el-empty"),q=(0,i.g2)("el-progress"),D=(0,i.g2)("el-image"),V=(0,i.g2)("el-icon-check"),$=(0,i.g2)("el-scrollbar"),B=(0,i.g2)("el-pagination"),K=(0,i.gN)("loading");return(0,i.uX)(),(0,i.CE)("div",r,[(0,i.bo)(((0,i.uX)(),(0,i.CE)("div",u,[(0,i.Lk)("div",n,[(0,i.bF)(X,{ref:"group",class:"menu",data:E.menu,"node-key":E.treeProps.key,props:E.treeProps,"current-node-key":E.menu.length>0?E.menu[0][E.treeProps.key]:"","highlight-current":"",onNodeClick:I.groupClick},{default:(0,i.k6)((({node:e})=>[(0,i.Lk)("span",c,[(0,i.bF)(z,{class:"icon"},{default:(0,i.k6)((()=>[(0,i.bF)(N)])),_:1}),(0,i.eW)((0,a.v_)(e.label),1)])])),_:1},8,["data","node-key","props","current-node-key","onNodeClick"])]),t.multiple?((0,i.uX)(),(0,i.CE)("div",d,[l[2]||(l[2]=(0,i.eW)(" 已选择 ")),(0,i.Lk)("b",null,(0,a.v_)(E.value.length),1),l[3]||(l[3]=(0,i.eW)(" / ")),(0,i.Lk)("b",null,(0,a.v_)(t.max),1),l[4]||(l[4]=(0,i.eW)(" 项 "))])):(0,i.Q3)("",!0)])),[[K,E.menuLoading]]),(0,i.bo)(((0,i.uX)(),(0,i.CE)("div",p,[(0,i.Lk)("div",f,[t.hideUpload?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",m,[(0,i.bF)(O,{class:"sc-file-select__upload",action:"",multiple:"","show-file-list":!1,accept:E.accept,"on-change":I.uploadChange,"before-upload":I.uploadBefore,"on-progress":I.uploadProcess,"on-success":I.uploadSuccess,"on-error":I.uploadError,"http-request":I.uploadRequest},{default:(0,i.k6)((()=>[(0,i.bF)(U,{type:"primary",icon:"el-icon-upload"},{default:(0,i.k6)((()=>l[5]||(l[5]=[(0,i.eW)("本地上传")]))),_:1})])),_:1},8,["accept","on-change","before-upload","on-progress","on-success","on-error","http-request"]),(0,i.Lk)("span",g,[(0,i.bF)(z,null,{default:(0,i.k6)((()=>[(0,i.bF)(W)])),_:1}),(0,i.eW)("大小不超过"+(0,a.v_)(t.maxSize)+"MB",1)])])),(0,i.Lk)("div",h,[(0,i.bF)(j,{modelValue:E.keyword,"onUpdate:modelValue":l[0]||(l[0]=e=>E.keyword=e),"prefix-icon":"el-icon-search",placeholder:"文件名搜索",clearable:"",onKeyup:(0,o.jR)(I.search,["enter"]),onClear:I.search},null,8,["modelValue","onKeyup","onClear"])])]),(0,i.Lk)("div",k,[(0,i.bF)($,{ref:"scrollbar"},{default:(0,i.k6)((()=>[0==E.fileList.length&&0==E.data.length?((0,i.uX)(),(0,i.Wv)(A,{key:0,description:"无数据","image-size":80})):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(E.fileList,((e,l)=>((0,i.uX)(),(0,i.CE)("div",{key:l,class:"sc-file-select__item"},[(0,i.Lk)("div",_,[(0,i.Lk)("div",b,[(0,i.bF)(q,{type:"circle",percentage:e.progress,width:70},null,8,["percentage"])]),(0,i.bF)(D,{src:e.tempImg,fit:"contain"},null,8,["src"])]),(0,i.Lk)("p",null,(0,a.v_)(e.name),1)])))),128)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(E.data,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e[E.fileProps.key],class:(0,a.C4)(["sc-file-select__item",{active:E.value.includes(e[E.fileProps.url])}]),onClick:l=>I.select(e)},[(0,i.Lk)("div",v,[t.multiple?((0,i.uX)(),(0,i.CE)("div",C,[(0,i.bF)(z,null,{default:(0,i.k6)((()=>[(0,i.bF)(V)])),_:1})])):((0,i.uX)(),(0,i.CE)("div",P,[(0,i.bF)(z,null,{default:(0,i.k6)((()=>[(0,i.bF)(V)])),_:1})])),l[6]||(l[6]=(0,i.Lk)("div",{class:"sc-file-select__item__box"},null,-1)),I._isImg(e[E.fileProps.url])?((0,i.uX)(),(0,i.Wv)(D,{key:2,src:e[E.fileProps.url],fit:"contain",lazy:""},null,8,["src"])):((0,i.uX)(),(0,i.CE)("div",F,[E.files[I._getExt(e[E.fileProps.url])]?((0,i.uX)(),(0,i.CE)("i",{key:0,class:(0,a.C4)(E.files[I._getExt(e[E.fileProps.url])].icon),style:(0,a.Tr)({color:E.files[I._getExt(e[E.fileProps.url])].color})},null,6)):((0,i.uX)(),(0,i.CE)("i",x))]))]),(0,i.Lk)("p",{title:e[E.fileProps.fileName]},(0,a.v_)(e[E.fileProps.fileName]),9,L)],10,y)))),128))])),_:1},512)]),(0,i.Lk)("div",w,[(0,i.bF)(B,{small:"",background:"",layout:"prev, pager, next",total:E.total,"page-size":E.pageSize,currentPage:E.currentPage,"onUpdate:currentPage":l[1]||(l[1]=e=>E.currentPage=e),onCurrentChange:I.reload},null,8,["total","page-size","currentPage","onCurrentChange"])]),(0,i.Lk)("div",S,[(0,i.RG)(e.$slots,"do",{},void 0,!0),(0,i.bF)(U,{type:"primary",disabled:E.value.length<=0,onClick:I.submit},{default:(0,i.k6)((()=>l[7]||(l[7]=[(0,i.eW)("确 定")]))),_:1},8,["disabled","onClick"])])])),[[K,E.listLoading]])])}t(8743),t(2838);var I=t(1552),N={apiObj:I.A.common.upload,menuApiObj:I.A.common.file.menu,listApiObj:I.A.common.file.list,successCode:200,maxSize:30,max:99,uploadParseData:function(e){return{id:e.data.id,fileName:e.data.fileName,url:e.data.src}},listParseData:function(e){return{rows:e.data.rows,total:e.data.total,msg:e.message,code:e.code}},request:{page:"page",pageSize:"pageSize",keyword:"keyword",menuKey:"groupId"},menuProps:{key:"id",label:"label",children:"children"},fileProps:{key:"id",fileName:"fileName",url:"url"},files:{doc:{icon:"sc-icon-file-word-2-fill",color:"#409eff"},docx:{icon:"sc-icon-file-word-2-fill",color:"#409eff"},xls:{icon:"sc-icon-file-excel-2-fill",color:"#67C23A"},xlsx:{icon:"sc-icon-file-excel-2-fill",color:"#67C23A"},ppt:{icon:"sc-icon-file-ppt-2-fill",color:"#F56C6C"},pptx:{icon:"sc-icon-file-ppt-2-fill",color:"#F56C6C"}}},z={props:{modelValue:null,hideUpload:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},max:{type:Number,default:N.max},onlyImage:{type:Boolean,default:!1},maxSize:{type:Number,default:N.maxSize}},data(){return{keyword:null,pageSize:20,total:0,currentPage:1,data:[],menu:[],menuId:"",value:this.multiple?[]:"",fileList:[],accept:this.onlyImage?"image/gif, image/jpeg, image/png":"",listLoading:!1,menuLoading:!1,treeProps:N.menuProps,fileProps:N.fileProps,files:N.files}},watch:{multiple(){this.value=this.multiple?[]:"",this.$emit("update:modelValue",JSON.parse(JSON.stringify(this.value)))}},mounted(){this.getMenu(),this.getData()},methods:{async getMenu(){this.menuLoading=!0;var e=await N.menuApiObj.get();this.menu=e.data,this.menuLoading=!1},async getData(){this.listLoading=!0;var e={[N.request.menuKey]:this.menuId,[N.request.page]:this.currentPage,[N.request.pageSize]:this.pageSize,[N.request.keyword]:this.keyword};this.onlyImage&&(e.type="image");var l=await N.listApiObj.get(e),t=N.listParseData(l);this.data=t.rows,this.total=t.total,this.listLoading=!1,this.$refs.scrollbar.setScrollTop(0)},groupClick(e){this.menuId=e.id,this.currentPage=1,this.keyword=null,this.getData()},reload(){this.getData()},search(){this.currentPage=1,this.getData()},select(e){const l=e[this.fileProps.url];this.multiple?this.value.includes(l)?this.value.splice(this.value.findIndex((e=>e==l)),1):this.value.push(l):this.value.includes(l)?this.value="":this.value=l},submit(){const e=JSON.parse(JSON.stringify(this.value));this.$emit("update:modelValue",e),this.$emit("submit",e)},uploadChange(e,l){e.tempImg=URL.createObjectURL(e.raw),this.fileList=l},uploadBefore(e){const l=e.size/1024/1024<this.maxSize;if(!l)return this.$message.warning(`上传文件大小不能超过 ${this.maxSize}MB!`),!1},uploadRequest(e){var l=N.apiObj;const t=new FormData;t.append("file",e.file),t.append([N.request.menuKey],this.menuId),l.post(t,{onUploadProgress:l=>{e.onProgress(l)}}).then((l=>{e.onSuccess(l)})).catch((l=>{e.onError(l)}))},uploadProcess(e,l){l.progress=Number((e.loaded/e.total*100).toFixed(2))},uploadSuccess(e,l){this.fileList.splice(this.fileList.findIndex((e=>e.uid==l.uid)),1);var t=N.uploadParseData(e);this.data.unshift({[this.fileProps.key]:t.id,[this.fileProps.fileName]:t.fileName,[this.fileProps.url]:t.url}),this.multiple||(this.value=t.url)},uploadError(e){this.$notify.error({title:"上传文件错误",message:e})},_isImg(e){const l=[".jpg",".jpeg",".png",".gif",".bmp"],t=e.substring(e.lastIndexOf("."));return-1!=l.indexOf(t)},_getExt(e){return e.substring(e.lastIndexOf(".")+1)}}},X=t(6262);const U=(0,X.A)(z,[["render",E],["__scopeId","data-v-48ded1ad"]]);var O=U,W={name:"fileselect",components:{scFileSelect:O},data(){return{file:"",multiple:!1,hideUpload:!1,upload:"",upload2:""}},mounted(){},methods:{submit(e){console.log(e),this.$message("返回值请查看F12控制台console.log()")}}};const j=(0,X.A)(W,[["render",s]]);var A=j}}]);